---
- name: Install nginx
  when: ansible_os_family == 'Debian'
  apt:
    name=nginx
    state=present

- name: Get nginx version
  shell: "/usr/sbin/nginx -v 2>&1 >/dev/null | sed -r 'sX^.*nginx/([0-9.]+).*$X\\1X'"
  register: nginx_v_result
  become: no

- name: Make sure sample host is absent
  when: ansible_os_family == 'Debian'
  file:
    path: /etc/nginx/sites-enabled/default
    state: absent
  notify: restart nginx

- name: nginx started
  service:
    name=nginx
    state=started
    enabled=yes

- name: Assure nginx running at end of playbook
  command: /bin/true
  notify: nginx started
